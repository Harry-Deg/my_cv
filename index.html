<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>CV — Harry DEGBEGNI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="cv">
    <!-- En-tête -->
    <header class="cv__header">
      <div class="cv__id">
        <h1 id="nom" class="cv__name">Harry DEGBEGNI</h1>
        <p id="note" class="cv__tagline">Data Enthousiaste</p>
        <p class="cv__meta">
          <span id="age"></span> ans •
          <span id="taille"></span> cm •
          <span id="sexe"></span>
        </p>
      </div>
    </header>

    <main class="cv__grid">
      <!-- Colonne principale -->
      <section class="section">
        <h2 class="section__title">Expériences professionnelles</h2>
        <div id="experiences" class="timeline"></div>
      </section>

      <section class="section">
        <h2 class="section__title">Formations</h2>
        <div id="formations"></div>
      </section>

      <section class="section">
        <h2 class="section__title">Compétences</h2>
        <div id="competences" class="skills"></div>
      </section>

      <section class="section">
        <h2 class="section__title">Expériences académiques</h2>
        <div id="academiques"></div>
      </section>

      <section class="section">
        <h2 class="section__title">Langues</h2>
        <ul id="langues" class="list"></ul>
      </section>

      <section class="section">
        <h2 class="section__title">Réalisations</h2>
        <ul id="realisations" class="list"></ul>
      </section>

      <section class="section">
        <h2 class="section__title">Hobbies</h2>
        <ul id="hobbies" class="list"></ul>
      </section>
    </main>
  </div>

  <script>
    // Helpers
    const isBlank = (v) => v === undefined || v === null || String(v).trim() === "" || String(v).trim() === "_";
    const cleanArray = (arr) => (Array.isArray(arr) ? arr.filter(x => !isBlank(x)) : []);
    const asArray = (v) => Array.isArray(v) ? v : (isBlank(v) ? [] : String(v).split(",").map(s => s.trim()).filter(Boolean));

    fetch("cv.json")
      .then(res => res.json())
      .then(cv => {
        // Header
        document.getElementById("nom").textContent = [cv.Prénom, cv.Nom].filter(Boolean).join(" ");
        document.getElementById("note").textContent = cv.Note || "";
        document.getElementById("age").textContent = cv.Age || "";
        document.getElementById("taille").textContent = cv.Taille || "";
        document.getElementById("sexe").textContent = cv.Sexe === "M" ? "Homme" : (cv.Sexe || "");

        // Expériences
        const expRoot = document.getElementById("experiences");
        (cv["Expériences Professionnelles"] || []).forEach(e => {
          const missions = cleanArray(e.Missions)
            .map(m => `<li>${m}</li>`).join("");
          const techs = asArray(e["Principales Technologies"])
            .map(t => `<span class="chip">${t}</span>`).join("");
          const plusValue = asArray(e["Plus Value"])
            .map(p => `<span class="chip chip--soft">${p}</span>`).join("");
          const client = !isBlank(e.Client) ? ` — Client : <strong>${e.Client}</strong>` : "";

          expRoot.insertAdjacentHTML("beforeend", `
            <article class="card">
              <div class="card__head">
                <h3 class="card__title">${e.Nom || ""} — ${e.Entreprise || ""}${client}</h3>
                <div class="card__meta">
                  <span>${e.Période || ""}</span> • <span>${e.Localisation || ""}</span>
                </div>
              </div>
              ${!isBlank(e.Description) ? `<p class="card__desc">${e.Description}</p>` : ""}
              ${missions ? `<ul class="card__list">${missions}</ul>` : ""}
              ${(techs || plusValue) ? `<div class="stack">${techs} ${plusValue}</div>` : ""}
            </article>
          `);
        });

        // Formations
        const formRoot = document.getElementById("formations");
        (cv.Formations || []).forEach(f => {
          formRoot.insertAdjacentHTML("beforeend", `
            <article class="row">
              <div class="row__main">
                <h3 class="row__title">${f.Nom || ""}</h3>
                <div class="row__meta">${f.Ecole || ""}</div>
                <div class="row__meta">${[f.Période, f.Localisation].filter(x => !isBlank(x)).join(" • ")}</div>
                ${!isBlank(f.Description) ? `<p class="row__desc">${f.Description}</p>` : ""}
              </div>
              <div class="row__aside">${f["Niveau Étude"] || ""}</div>
            </article>
          `);
        });

        // Compétences (groupées par catégories)
        const compRoot = document.getElementById("competences");
        (cv.Compétences || []).forEach(cat => {
          const items = cleanArray(cat.Liste);
          if (items.length) {
            compRoot.insertAdjacentHTML("beforeend", `
              <div class="skill-group">
                <div class="skill-group__title">${cat.Nom}</div>
                <div class="skill-group__chips">
                  ${items.map(it => `<span class="chip">${it}</span>`).join("")}
                </div>
              </div>
            `);
          }
        });

        // Expériences académiques
        const acadRoot = document.getElementById("academiques");
        (cv["Expériences Académiques"] || []).forEach(block => {
          const items = cleanArray(block.Réalisation).map(r => `
            <li><strong>${r.Intitulé || ""}</strong> — ${r.Description || ""}</li>
          `).join("");
          if (items) {
            acadRoot.insertAdjacentHTML("beforeend", `
              <article class="card">
                <h3 class="card__title">${block.Programme || ""}</h3>
                <ul class="card__list">${items}</ul>
              </article>
            `);
          }
        });

        // Langues
        const langRoot = document.getElementById("langues");
        cleanArray(cv.Langues).forEach(l => {
          langRoot.insertAdjacentHTML("beforeend", `
            <li><strong>${l.Nom || ""}</strong> — ${l.Niveau || ""}</li>
          `);
        });

        // Réalisations
        const realRoot = document.getElementById("realisations");
        cleanArray(cv.Réalisations).forEach(r => {
          if (!isBlank(r.Nom)) {
            realRoot.insertAdjacentHTML("beforeend", `
              <li><strong>${r.Nom}</strong> — ${r.Description || ""}</li>
            `);
          }
        });

        // Hobbies
        const hobRoot = document.getElementById("hobbies");
        cleanArray(cv.Hobbies).forEach(h => {
          hobRoot.insertAdjacentHTML("beforeend", `
            <li><strong>${h.Nom || ""}</strong> — ${h.Description || ""}</li>
          `);
        });
      })
      .catch(err => {
        document.body.insertAdjacentHTML("beforeend",
          `<p style="color:#b00020;text-align:center">Erreur de chargement du CV : ${err}</p>`);
      });
  </script>
</body>
</html>
